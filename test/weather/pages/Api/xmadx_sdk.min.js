"use strict";var xmad=function(a,b){try{var c="wepy"===a}catch(a){}try{var d=a.prototype.constructor.name;if(d){var e,f;"App"===b?e=a:f=a}}catch(a){}var g=require("./xmadx_conf.js"),h=require("./xmadx_MD5.js"),i=0,j={};if(!g.app_key||32!==g.app_key.length){console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u914D\u7F6E\u9519\u8BEF\uFF0C\u8BF7\u5728xmadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6E\u60A8\u7684app_key\u3002");var k=function(a){e?e(a):App(a)},l=function(a){f?f(a):Page(a)};return{xmApp:k,xmPage:l}}var m={ak:g.app_key.replace(/(^\s*)|(\s*$)/g,""),v:"1.5.0",asid:"",reqid:"",pb:"",pm:"",sv:"",pv:"",nt:"",ww:0,wh:0,pr:0,long:0,lat:0,wvv:"",wv:"",lang:"",wsr:{},pp:"",uuid:"",drop:{hasCollect:!1,hasSell:!1},user_info:{}},n=0,o=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var b;try{if(b=wx.getStorageSync("xmaduuid"),b)return b}catch(a){}b=a()+a()+a()+a()+a()+a()+a()+a();try{wx.setStorageSync("xmaduuid",b)}catch(a){}return b},q="pages/xmadPage/sell",r="pages/xmadPage/collect",p=function(){var a=!1,b=!1;try{var c=__wxConfig.pages;a=c.some(function(a){return a===q}),b=c.some(function(a){return a===r})}catch(a){}m.drop.hasSell=a,m.drop.hasCollect=b},s=function(a){function b(){4===c.length&&(n=1,a&&a())}var c=[];(function(){wx.getSetting({success:function(a){a.authSetting["scope.userInfo"]?wx.getUserInfo({withCredentials:!1,success:function(a){m.user_info=a.userInfo},complete:function(){c.push("ok1"),b()}}):(c.push("ok1"),b())},fail:function(){c.push("ok1"),b()}})})(),function(){wx.getSystemInfo({success:function(a){m.wv="undefined"==typeof a.SDKVersion?"1.0.0":a.SDKVersion,m.pb=a.brand,m.pm=a.model,m.pr=a.pixelRatio,m.ww=a.screenWidth,m.wh=a.screenHeight,m.lang=a.language,m.wvv=a.version,m.sv=a.system,m.pv=a.platform},complete:function(){c.push("ok2"),b()}})}(),function(){wx.getSetting({success:function(a){a.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(a){m.long=a.latitude,m.lat=a.longitude},complete:function(){c.push("ok3"),b()}}):(c.push("ok3"),b())},fail:function(){c.push("ok3"),b()}})}(),function(){wx.getNetworkType({success:function(a){m.nt=a.networkType},complete:function(){c.push("ok4"),b()}})}()},t=function(a){return 1===a?{dTag:"xm_banner",dClass:"banner_style"}:2===a?{dTag:"xm_insert",dClass:"screen_style"}:3===a?{dTag:"xm_fixed",dClass:"fixed_style"}:void 0},u=function(a,b){return 32==b.length?void v(b,["engine","v1/api/ad"],function(d){if(200==d.data.code){var e=d.data.data;j[b]=e,j[b].hasshow=!0,j[b].id=b,j[b].push=0;var f=t(e.ct);if(f){j[b].style=H[f.dClass];var g=a.data.xmad;g.adData=j,c?a.xmapply(j):a.setData({xmad:g})}}else;}):console.warn("\u5E7F\u544A\u4F4DID\u5E94\u4E3A\u957F\u5EA6\u4E3A32\u4F4D\uFF0C\u8BF7\u68C0\u67E5\u60A8\u5728js\u4E2D'xmad'\u7684\u914D\u7F6E--"+b)},v=function(a,b,c,d){0===n?s(function(){w(a,c,b,d)}):w(a,c,b,d)},w=function(a,b,c,d){var d=d?"get":"post",e="https://"+c[0]+".xmadx.net/";if(m.asid=a,m.uuid=m.uuid||o(),"log"!=c[0]){var f=Date.now()+m.ak+m.uuid+m.asid;m.reqid=h.hexMD5(f)}var g=0,i=function a(){wx.request({url:e+c[1],data:m,header:{},method:d,success:function(a){b(a);console.log(a)},fail:function(err){2>g&&(g++,m.retryTimes=g,setTimeout(function(){a()},1e3));console.log(err)}})};i()},x=function(a){m.uuid=o(),wx.login({success:function(a){var b={jscode:encodeURIComponent(a.code),uuid:m.uuid,appkey:m.ak},c="https://engine.xmadx.net/";wx.request({url:c+"v1/api/init",method:"post",data:b})},fail:function(){}}),wx.setStorageSync("xmwsr",a)},y=function(){p(),m.wsr=wx.getStorageSync("xmwsr"),m.pp=this.route;var a;try{a=this.data.xmad.ad}catch(a){}if(a){var b=this;for(var c in a)"banner"==c&&"Array"===Object.prototype.toString.call(a[c]).split(" ")[1].slice(0,-1)?a[c].forEach(function(a){u(b,a)}):u(b,a[c])}},z=function(){var a=this.options.xmadH5url;a&&(a=a.replace("|","?").replace("$","="),this.setData({xmadURL:a}))},A=function(a,b){var c=c?"get":"post",d="https://log.xmadx.net/",e={};/imp/.test(b)?e.iurl=a:e.curl=a;var f=0;(function a(){wx.request({url:d+b,data:e,method:c?"post":"get",success:function(){},fail:function(){2>f&&(f++,e.retryTimes=f,setTimeout(function(){a()},1e3))}})})()},B=function(a){var b=a.currentTarget.dataset.id,c=j[b];if(0===c.push){var d=c.iurl.split("?")[1];if(1===c.ct){var e=this,f=wx.createIntersectionObserver(e,{thresholds:[.2],selectAll:!0});f.relativeToViewport().observe(".xm_banner",function(a){if(.2<a.intersectionRatio){var c=e.data.xmad;c.adData[b].push=1,e.setData({xmad:c}),A(d,"v1/api/imp",["log","imp"],function(){},"get"),f.disconnect()}})}else A(d,"v1/api/imp",["log","imp"],function(){},"get")}},C=function(a){var b=a.currentTarget.dataset.id,c=this.data.xmad;c.adData[b].hasshow=!1,this.setData({xmad:c})},D=function(a){var b=a.currentTarget.dataset.id,d=j[b].curl.replace(/cst=/gi,"cst="+Date.now());d=d.split("?")[1];var e=j[b].at;switch(e){case 1:{var f=g.h5_path||c?"/pages/xmadH5":"/pages/xmadH5/xmadH5",h=j[b].h5link.replace("?","|").replace("=","$");h&&wx.navigateTo({url:f+"?xmadH5url="+h,success:function(){A(d,"v1/api/clk",["log","imp"],function(){},"get")},fail:function(){console.warn("\u5C0F\u76DF\u63D0\u793A\uFF1A\u8DF3\u8F6CH5\u5E7F\u544A\u5931\u8D25\uFF0C\u8BF7\u5728xmadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6Eh5_path\u5B57\u6BB5\u3002")}});break}case 2:{a.currentTarget.dataset.adImgUrl||(a.currentTarget.dataset.adImgUrl=j[b].appimg),wx.previewImage({current:a.currentTarget.dataset.adImgUrl,urls:[a.currentTarget.dataset.adImgUrl],success:function(){A(d,"v1/api/clk",["log","imp"],function(){},"get")}});break}case 3:case 4:{A(d,"v1/api/clk",["log","imp"],function(){},"get");break}case 5:case 6:{var i,k=j[b].page,l=m.ak,n=m.uuid,o=j[b].isAccredit,p=j[b].curl.split("?")[1].replace(/=/gi,"!"),s="https://engine.xmadx.net/v1/api/";1==k.purpose&&(i=r),2==k.purpose&&(i=q),i&&wx.navigateTo({url:"/"+i+"?xmadPage="+k.config+"&title="+k.title+"&pagekey="+k.page_key+"&appkey="+l+"&ukey="+n+"&hasAuth="+o+"&bs="+s+"&cu="+p,success:function(){A(d,"v1/api/clk",["log","imp"],function(){},"get")},fail:function(a){console.warn(a,"\u5C0F\u76DF\u63D0\u793A\uFF1A\u8DF3\u8F6C\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u5185\u7F6E\u5E7F\u544A\u9875\u662F\u5426\u914D\u7F6E\u6B63\u786E\u3002")}});break}default:{console.error("SDK\u9519\u8BEF\uFF1A\u8DF3\u8F6C\u7C7B\u578Bat\u4E3A\uFF1A"+e+" \uFF0C\u4E0D\u662F\u7EA6\u5B9A\u7684\u7C7B\u578B\u3002\u65E0\u6CD5\u8FDB\u884C\u8DF3\u8F6C\u3001\u70B9\u51FB\u4E0A\u62A5\uFF0C\u8054\u7CFBGO\u5DE5\u7A0B\u5E08\uFF01\uFF01\uFF01");break}}},E=function(a,b,c){var d=a[b];a[b]=function(a){d&&d.call(this,a),c.call(this,a)}},F=function(a){E(a,"onLaunch",x),e?e(a):App(a)},G=function(a){E(a,"onLoad",y),E(a,"onShow",z),E(a,"xmadClose",C),E(a,"adImgLoad",B),E(a,"appoIntView",D),f?f(a):Page(a)},H={banner_style:{wrap:"position: relative; display: flex; width: 100%; overflow: hidden",img:"width: 100%; margin: 0 auto;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"},screen_style:{wrap:"position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, .3); z-index: 9999;",content:"position: relative; display: flex; width: 600rpx !important; overflow: hidden; left: calc(50% - 300rpx); top: calc(50% - 250rpx)",img:"width: 100%;",close:"position: absolute; top: 0; right: 0; width: 34rpx !important; height: 34rpx !important; padding: 10rpx; z-index: 2",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;"},fixed_style:{wrap:"position: fixed; display: flex; width: 120rpx !important; right: 60rpx; bottom: 60rpx; z-index: 9998;",img:"width: 100%;",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"}};return{xmApp:F,xmPage:G}};exports.xmad=xmad;